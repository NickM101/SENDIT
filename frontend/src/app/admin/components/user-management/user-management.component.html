<div class="user-management-container">
  <div class="row">
    <div class="col-12">
      <h2>User Management</h2>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
          <li class="breadcrumb-item"><a routerLink="/admin">Admin</a></li>
          <li class="breadcrumb-item active">User Management</li>
        </ol>
      </nav>
    </div>
  </div>

  <ng-container *ngIf="!showUserForm">
    <!-- User Stats Cards -->
    <div class="row mb-4" *ngIf="userStats">
      <div class="col-md-3 mb-3">
        <div class="stat-card card">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="stat-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="stat-content">
                <h3>{{ userStats.totalUsers }}</h3>
                <p>Total Users</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-3 mb-3">
        <div class="stat-card card">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="stat-icon">
                <i class="fas fa-user-check"></i>
              </div>
              <div class="stat-content">
                <h3>{{ userStats.activeUsers }}</h3>
                <p>Active Users</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-3 mb-3">
        <div class="stat-card card">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="stat-icon">
                <i class="fas fa-user-slash"></i>
              </div>
              <div class="stat-content">
                <h3>{{ userStats.inactiveUsers }}</h3>
                <p>Inactive Users</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-3 mb-3">
        <div class="stat-card card">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="stat-icon">
                <i class="fas fa-user-shield"></i>
              </div>
              <div class="stat-content">
                <h3>{{ userStats.adminUsers }}</h3>
                <p>Admin Users</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- User List Table -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5>All Users</h5>
            <button class="btn btn-primary btn-sm" (click)="openCreateUserModal()">
              <i class="fas fa-plus me-2"></i>Add New User
            </button>
          </div>
          <div class="card-body">
            <div class="row mb-3">
              <div class="col-md-6">
                <input type="text" class="form-control" placeholder="Search by name or email" [(ngModel)]="searchQuery" (input)="applyFilters()">
              </div>
              <div class="col-md-3">
                <select class="form-select" [(ngModel)]="selectedRole" (change)="applyFilters()">
                  <option value="">All Roles</option>
                  <option value="USER">User</option>
                  <option value="ADMIN">Admin</option>
                  <option value="PREMIUM_USER">Premium User</option>
                </select>
              </div>
              <div class="col-md-3">
                <select class="form-select" [(ngModel)]="selectedStatus" (change)="applyFilters()">
                  <option value="">All Statuses</option>
                  <option value="true">Active</option>
                  <option value="false">Inactive</option>
                </select>
              </div>
            </div>

            <div *ngIf="loading" class="text-center">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <p>Loading users...</p>
            </div>
            <div *ngIf="error" class="alert alert-danger">
              {{ error }}
            </div>
            <div *ngIf="!loading && !error && users.length === 0" class="alert alert-info">
              No users found.
            </div>

            <div class="table-responsive" *ngIf="!loading && !error && users.length > 0">
              <table class="table table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Roles</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let user of users">
                    <td>{{ user.name }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phone }}</td>
                    <td>
                      <span *ngFor="let role of user.role" class="badge bg-info me-1">{{ role }}</span>
                    </td>
                    <td>
                      <span class="badge" [ngClass]="{'bg-success': user.isActive, 'bg-danger': !user.isActive}">
                        {{ user.isActive ? 'Active' : 'Inactive' }}
                      </span>
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary me-2" (click)="editUser(user.id)">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-warning me-2" (click)="toggleUserStatus(user)">
                        <i class="fas" [ngClass]="{'fa-toggle-on': user.isActive, 'fa-toggle-off': !user.isActive}"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" (click)="deleteUser(user.id)">
                        <i class="fas fa-trash-alt"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Pagination -->
            <nav *ngIf="totalUsers > itemsPerPage">
              <ul class="pagination justify-content-center">
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <a class="page-link" (click)="onPageChange(currentPage - 1)">Previous</a>
                </li>
                <li class="page-item" *ngFor="let page of [].constructor(totalUsers / itemsPerPage | ceil)" [class.active]="currentPage === page">
                  <a class="page-link" (click)="onPageChange(page)">{{ page }}</a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === (totalUsers / itemsPerPage | ceil)">
                  <a class="page-link" (click)="onPageChange(currentPage + 1)">Next</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-container *ngIf="showUserForm">
    <app-user-form
      [user]="selectedUser"
      (formSubmitted)="onFormSubmitted()"
      (formCancelled)="onFormCancelled()"
    ></app-user-form>
  </ng-container>
</div>